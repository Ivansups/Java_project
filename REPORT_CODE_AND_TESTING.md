# Отчет по этапу «Кодирование и тестирование приложения»

## Структура приложения (архитектура)
- Архитектурный стиль: десктопное Swing-приложение с трехслойной логикой.
- UI (Swing): `com.library.gui.*` — окна под роли (`LoginWindow`, `GuestCatalogWindow`, `ReaderWindow`, `AdminWindow`), общая стилизация в `util.UITheme`.
- Бизнес-логика: `auth.UserManager` (аутентификация и роли), `database.DatabaseManager` (CRUD для книг, читателей, пользователей, выдач; статистика; инициализация БД с тестовыми данными).
- Модель данных: `model.Book`, `model.Reader`, `model.Loan` — POJO-объекты, отражающие строки таблиц и сущности предметной области.
- Точка входа: `Main` — запуск приложения и первичная инициализация БД/окна логина.
- Хранение данных: SQLite (`library.db` по умолчанию), автосоздание таблиц и тестовых записей при первом запуске.
- Тестовая инфраструктура: `src/test/java` с `DatabaseTestHelper` (временная БД и сброс синглтонов) + JUnit/AssertJ/AssertJ Swing тесты.

### PlantUML (общая структура)
```plantuml
@startuml
title Library System (Swing + SQLite)

package "UI (Swing)" {
  class Main
  class LoginWindow
  class GuestCatalogWindow
  class ReaderWindow
  class AdminWindow
}

package "Logic" {
  class UserManager
  class DatabaseManager
}

package "Model" {
  class Book
  class Reader
  class Loan
}

database "SQLite (library.db)" as DB

Main --> LoginWindow
LoginWindow --> GuestCatalogWindow : guest
LoginWindow --> ReaderWindow : role=READER
LoginWindow --> AdminWindow : role=ADMIN

LoginWindow --> UserManager
GuestCatalogWindow --> DatabaseManager
ReaderWindow --> DatabaseManager
AdminWindow --> DatabaseManager

UserManager --> DatabaseManager : authenticate/getRole
DatabaseManager --> DB : JDBC (SQLite)

DatabaseManager --> Book
DatabaseManager --> Reader
DatabaseManager --> Loan
@enduml
```

## 1. Перечень требований к программному средству
Использованы требования из этапа «Системный анализ» (сводка по ролям):
- Гость: просмотр каталога, поиск по названию/автору, переход к авторизации.
- Читатель: вход в систему; просмотр каталога; поиск; просмотр своих выдач; продление активной выдачи.
- Администратор: управление книгами, читателями, выдачами; управление системными пользователями (CRUD, смена роли/пароля, защита от удаления себя); просмотр статистики (книги, читатели, активные и просроченные выдачи).
- Общие/нефункциональные: современный UI (Sber-палитра), валидация данных, автоматическое создание и заполнение БД, сообщения об ошибках/подтверждениях.

## 2. Перечисление выполненных требований
Все перечисленные выше требования реализованы (подтверждается `FUNCTIONALITY.md`). Ключевые моменты:
- Авторизация и маршрутизация по ролям (ADMIN/READER + гостевой каталог).
- Полный CRUD для книг, читателей, пользователей (ADMIN/READER роли); операции выдачи/возврата; поиск в каталоге.
- Продление выдач для читателя с проверкой просрочки.
- Статистика по фонду/читателям/выдачам.
- UI в едином стиле с валидацией и диалогами подтверждения.
- Автоматическая инициализация SQLite с тестовыми данными.

## 3. Перечисление невыполненных или измененных требований
- Невыполненных требований нет.
- Изменений требований на этапе реализации не вносилось.

## 4. Анализ согласованности модели
- Модель предметной области (книги, читатели, выдачи, пользователи) полностью соответствует реализованным сущностям `Book`, `Reader`, `Loan`, `SystemUser`.
- Ролевые сценарии (Guest/Reader/Admin) отражены в отдельных окнах (`GuestCatalogWindow`, `ReaderWindow`, `AdminWindow`) и в логике `UserManager`.
- Связи и ограничения БД (FK, уникальные поля, счетчики доступных экземпляров) реализованы в `DatabaseManager` и проверяются в операциях выдачи/возврата/регистрации.

## 5. Описание плана тестирования и результаты
- **Функциональные unit-тесты (JUnit 5, AssertJ)**: `DatabaseManagerBooksTest`, `DatabaseManagerReadersTest`, `DatabaseManagerUsersTest`, `DatabaseManagerLoansTest`, `ModelTests`.
  - Проверяют CRUD книг/читателей/пользователей, выдачи/возвраты/продления, бизнес-ограничения (доступные экземпляры, статусы, просрочка).
- **GUI-тесты (AssertJ Swing)**: `LoginWindowTest`, `GuestCatalogWindowTest`.
  - Проверяют сценарии логина (успех/ошибка/Enter), переход гостя, загрузку и фильтрацию каталога, кнопки «Показать все» и возврат к логину.
- **Инфраструктура для тестов**: `DatabaseTestHelper` создает временную SQLite-БД и сбрасывает синглтоны, обеспечивая изоляцию.
- **Результаты**: `mvn test` — **PASS** (28 тестов, 0 ошибок). В консоли возможны предупреждения AssertJ Swing о reflection в JDK 17+; на работу не влияют.

## 6. Инструкции для пользователя
- Запуск: `mvn clean install` и запуск `com.library.Main` (создается `library.db` с тестовыми данными).
- Логины по ролям (из `DatabaseManager.insertDefaultUsers()`):
  - Админ: `admin/admin`, `admin1/admin123`, `root/root`
  - Читатель: `reader/reader`, `reader1/read123`, `reader2/read456` и др. (petrov, sidorov, kozlov, volkov, novikov, morozov, sokolov)
- Основные действия:
  - Гость: открыть каталог, поиск, перейти к логину.
  - Читатель: после входа — каталог, история выдач, продление активных выдач.
  - Администратор: управление книгами, читателями, выдачами; управление пользователями (ADMIN/READER); статистика (книги, читатели, активные/просроченные выдачи).
- UI: зеленая палитра, диалоги успеха/ошибок/подтверждений, поля с валидацией.

## 7. Демонстрационный вариант приложения
- При первом запуске автоматически создается и наполняется `library.db` (57 книг, 20 читателей, 13 пользователей — роли ADMIN/READER).
- Для демонстрации достаточно запустить `Main` и войти под одной из указанных учетных записей, либо открыть гостевой каталог без авторизации.

