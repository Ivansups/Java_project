# Отчет по этапу «Кодирование и тестирование приложения»

## 1. Перечень требований к программному средству
Использованы требования из этапа «Системный анализ» (сводка по ролям):
- Гость: просмотр каталога, поиск по названию/автору, переход к авторизации.
- Читатель: вход в систему; просмотр каталога; поиск; просмотр своих выдач; продление активной выдачи.
- Библиотекарь: вход; управление книгами (добавление, редактирование, удаление, поиск); управление читателями (регистрация, редактирование, просмотр); управление выдачами (оформление, возврат, просмотр).
- Администратор: все функции библиотекаря + управление системными пользователями (CRUD, смена роли/пароля, защита от удаления себя) + просмотр статистики (книги, читатели, активные и просроченные выдачи).
- Общие/нефункциональные: современный UI (Sber-палитра), валидация данных, автоматическое создание и заполнение БД, сообщения об ошибках/подтверждениях.

## 2. Перечисление выполненных требований
Все перечисленные выше требования реализованы (подтверждается `FUNCTIONALITY.md`). Ключевые моменты:
- Авторизация и маршрутизация по ролям.
- Полный CRUD для книг, читателей, пользователей; операции выдачи/возврата; поиск в каталоге.
- Продление выдач для читателя с проверкой просрочки.
- Статистика по фонду/читателям/выдачам.
- UI в едином стиле с валидацией и диалогами подтверждения.
- Автоматическая инициализация SQLite с тестовыми данными.

## 3. Перечисление невыполненных или измененных требований
- Невыполненных требований нет.
- Изменений требований на этапе реализации не вносилось.

## 4. Анализ согласованности модели
- Модель предметной области (книги, читатели, выдачи, пользователи) полностью соответствует реализованным сущностям `Book`, `Reader`, `Loan`, `SystemUser`.
- Ролевые сценарии (Guest/Reader/Librarian/Admin) отражены в отдельных окнах (`GuestCatalogWindow`, `ReaderWindow`, `LibrarianWindow`, `AdminWindow`) и в логике `UserManager`.
- Связи и ограничения БД (FK, уникальные поля, счетчики доступных экземпляров) реализованы в `DatabaseManager` и проверяются в операциях выдачи/возврата/регистрации.

## 5. Описание плана тестирования и результаты
- **Функциональные unit-тесты (JUnit 5, AssertJ)**: `DatabaseManagerBooksTest`, `DatabaseManagerReadersTest`, `DatabaseManagerUsersTest`, `DatabaseManagerLoansTest`, `ModelTests`.
  - Проверяют CRUD книг/читателей/пользователей, выдачи/возвраты/продления, бизнес-ограничения (доступные экземпляры, статусы, просрочка).
- **GUI-тесты (AssertJ Swing)**: `LoginWindowTest`, `GuestCatalogWindowTest`.
  - Проверяют сценарии логина (успех/ошибка/Enter), переход гостя, загрузку и фильтрацию каталога, кнопки «Показать все» и возврат к логину.
- **Инфраструктура для тестов**: `DatabaseTestHelper` создает временную SQLite-БД и сбрасывает синглтоны, обеспечивая изоляцию.
- **Результаты**: `mvn test` — **PASS** (28 тестов, 0 ошибок). В консоли возможны предупреждения AssertJ Swing о reflection в JDK 17+; на работу не влияют.

## 6. Инструкции для пользователя
- Запуск: `mvn clean install` и запуск `com.library.Main` (создается `library.db` с тестовыми данными).
- Логины по ролям (из `DatabaseManager.insertDefaultUsers()`):
  - Админ: `admin/admin`, `admin1/admin123`, `root/root`
  - Библиотекарь: `librarian/librarian`, `librarian1/lib123`, `librarian2/lib456`, `maria/maria123`, `ivan/ivan123`
  - Читатель: `reader/reader`, `reader1/read123`, `reader2/read456` и др. (petrov, sidorov, kozlov, …)
- Основные действия:
  - Гость: открыть каталог, поиск, перейти к логину.
  - Читатель: после входа — каталог, история выдач, продление активных выдач.
  - Библиотекарь: вкладки книг/читателей/выдач — добавление/редактирование/удаление, поиск, оформление выдачи и возврата.
  - Администратор: дополнительно вкладка пользователей (создание, смена роли/пароля, удаление с защитой от удаления себя) и статистика (книги, читатели, активные/просроченные выдачи).
- UI: зеленая палитра, диалоги успеха/ошибок/подтверждений, поля с валидацией.

## 7. Демонстрационный вариант приложения
- При первом запуске автоматически создается и наполняется `library.db` (57 книг, 20 читателей, 18 пользователей).
- Для демонстрации достаточно запустить `Main` и войти под одной из указанных учетных записей, либо открыть гостевой каталог без авторизации.

